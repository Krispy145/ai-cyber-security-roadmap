#!/usr/bin/env bash
set -euo pipefail

REPO_ROOT="$(git rev-parse --show-toplevel)"
cd "$REPO_ROOT"

echo "→ Validating manifest.json..."
python3 scripts/validate_manifest.py

echo "→ Checking README generation..."
python3 scripts/manifest2readme.py

echo "→ Updating repository READMEs..."
python3 scripts/update_readmes.py

# Check if any README files were modified
if ! git diff --quiet -- "**/README.md"; then
  echo "✖ README files need to be updated from manifest."
  echo "Run: python3 scripts/update_readmes.py && git add ."
  git --no-pager diff -- "**/README.md"
  exit 1
fi

echo "✓ Pre-commit checks passed."
